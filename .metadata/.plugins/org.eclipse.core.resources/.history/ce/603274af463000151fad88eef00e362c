// lab 03
// http://www.ccs.neu.edu/course/cs2510su13-1/labs/lab3.html
// Ex 02

import tester.Tester;

// an XML is a ListOf<XMLFragment>

//REPRESENTS: a XML
interface IXML{
	// RETURNS: the length of content in this document
	int contentLength();
	
	// RETURNS: the maximum number of tag nesting in a document
	int maxNest();
	
	// RETURNS: true iff this document has the given tag
	boolean hasTag(Tag tag);
	
	// RETURNS: true iff this document has the given attribute
	boolean hasAttribute(String attr);
	
	// RETURNS: true iff this document hat the given attribute in the given tag
	boolean hasAttributeInTag(String attr, Tag tag);
}

//REPRESENTS: an empty list of XML fragment
class MTLoXMLFragment implements IXML {
	public MTLoXMLFragment() {}
	
	// RETURNS: the length of content in this document
	public int contentLength() {
		return 0;
	}
	
	// RETURNS: the maximum number of tag nesting in a document
	public int maxNest() {
		return 0;
	}
	
	// RETURNS: true iff this document has the given tag
	public boolean hasTag(Tag tag) {
		return false;
	}
	
	// RETURNS: true iff this document has the given attribute
	public boolean hasAttribute(String attr) {
		return false;
	}
	
	// RETURNS: true iff this document has the given attribute in the given tag
	public boolean hasAttributeInTag(String attr, Tag tag) {
		return false;
	}
}

//REPRESENTS: a non-empty list of XML fragments
class ConsLoXMLFragment implements IXML {
	IXMLFragment fst;
	IXML rst;
	
	public ConsLoXMLFragment(IXMLFragment fst, IXML rst) {
		this.fst = fst;
		this.rst = rst;
	}
	
	// RETURNS: the length of content in this document
	public int contentLength() {
		return this.fst.contentLength() + this.rst.contentLength();
	}
	
	// RETURNS: the maximum number of tag nesting in a document
	public int maxNest() {
		return Math.max(this.fst.maxNest(), this.rst.maxNest());
	}
	
	// RETURNS: true iff this document has the given tag
	public boolean hasTag(Tag tag) {
		return this.fst.hasTag(tag) || this.rst.hasTag(tag);
	}
	
	// RETURNS: true iff this document has the given attribute
	public boolean hasAttribute(String attr) {
		return this.fst.hasAttribute(attr) || this.rst.hasAttribute(attr);
	}
	
	// RETURNS: true iff this document has the given attribute in the given tag
	public boolean hasAttributeInTag(String attr, Tag tag) {
		return this.fst.hasAttributeInTag(attr, tag) ||
				this.rst.hasAttributeInTag(attr, tag);
	}
}


// REPRESENTS: a XML fragment
interface IXMLFragment{
	// RETURNS: the length of content in this XML fragment
	int contentLength();
	
	// RETURNS: the maximum number of tag nesting this XML fragment
	int maxNest();
	
	// RETURNS: true iff this XML fragment has the given tag
	boolean hasTag(Tag tag);
	
	// RETURNS: true iff this XML fragment has the given attribute
	boolean hasAttribute(String attr);
	
	// RETURNS: true iff this XML fragment has the given attribute in the given tag
	boolean hasAttributeInTag(String attr, Tag tag);
}

// REPRESENTS: a non tagged XML fragment
class NoTaggedXMLFragment implements IXMLFragment {
	String planContent; // plan content
	
	public NoTaggedXMLFragment(String planContent) {
		this.planContent = planContent;
	}
	
	// RETURNS: the length of content in this XML fragment
	public int contentLength() {
		return this.planContent.length();
	}
	
	// RETURNS: the maximum number of tag nesting this XML fragment
	public int maxNest() {
		return 0;
	}
	
	// RETURNS: true iff this XML fragment has the given tag
	public boolean hasTag(Tag tag) {
		return false;
	}
	
	// RETURNS: true iff this XML fragment has the given attribute
	public boolean hasAttribute(String attr) {
		return false;
	}
	
	// RETURNS: true iff this XML fragment has the given attribute in the given tag
	public boolean hasAttributeInTag(String attr, Tag tag) {
		return false;
	}
}

// REPRESETNS: a tagged XML fragment
class TaggedXMLFragment implements IXMLFragment {
	Tag tag;
	ILoAttributeValuePair attributesValuePairs;
	IXML xml;
	
	TaggedXMLFragment(Tag tag, ILoAttributeValuePair attributeValuePairs, 
				IXML xml) {
		this.tag = tag;
		this.attributesValuePairs = attributeValuePairs;
		this.xml = xml;
	}
	
	// RETURNS: the length of content in this XML fragment
	public int contentLength() {
		return this.xml.contentLength();
	}
	
	// RETURNS: the maximum number of tag nesting this XML fragment
	public int maxNest() {
		return 1 + this.xml.maxNest();
	}
	
	// RETURNS: true iff this XML fragment has the given tag
	public boolean hasTag(Tag tag) {
		return this.tag.equals(tag) || this.xml.hasTag(tag);
	}
	
	// RETURNS: true iff this XML fragment has the given attribute
	public boolean hasAttribute(String attr) {
		return this.attributesValuePairs.hasAttribute(attr) ||
				this.xml.hasAttribute(attr);
	}
	
	// RETURNS: true iff this XML fragment has the given attribute in the given tag
	public boolean hasAttributeInTag(String attr, Tag tag) {
		if(this.tag.equals(tag)) {
			return this.attributesValuePairs.hasAttribute(attr) ||
					this.xml.hasAttributeInTag(attr, tag);
		}
		else {
			return this.xml.hasAttributeInTag(attr, tag);
		}
		
	}
}

class Tag {
	String tag;
	
	Tag(String tag) {
		this.tag = tag;
	}
	
	// RETURNS: true iff this tag equals to that tag
	public boolean equals(Tag that) {
		return this.tag.equals(that.tag);
	}
}

interface ILoAttributeValuePair {
	// RETURNS: true iff this list  has the given attribute
	boolean hasAttribute(String attr);
}
class MTLoAttributeValuePair implements ILoAttributeValuePair {
	public MTLoAttributeValuePair() {}
	
	// RETURNS: true iff this list  has the given attribute
	public boolean hasAttribute(String attr) {
		return false;
	}
}
class ConsLoAttributeValuePair implements ILoAttributeValuePair {
	AttributeValuePair fst;
	ILoAttributeValuePair rst;
	
	public ConsLoAttributeValuePair(AttributeValuePair fst, ILoAttributeValuePair rst) {
		this.fst = fst;
		this.rst = rst;
	}
	
	// RETURNS: true iff this list  has the given attribute
	public boolean hasAttribute(String attr) {
		return this.fst.attributeEquals(attr) ||
				this.rst.hasAttribute(attr);
	}
}

 
class AttributeValuePair {
	String attribute;
	String value;
	
	public AttributeValuePair(String attribute, String value) {
		this.attribute = attribute;
		this.value = value;
	}
	
	// RETURNS: true iff the attribute of this pair equals to the given pair
	public boolean attributeEquals(String attr) {
		return this.attribute.equals(attr);
	}
}

class XMLExamples {
	IXMLFragment xmlf1 = new NoTaggedXMLFragment("I am XML!");
	IXML mtLoXML = new MTLoXMLFragment();
	IXML xml1 = new ConsLoXMLFragment(xmlf1, mtLoXML);
	
	IXMLFragment xmlf2 = new NoTaggedXMLFragment("I am ");
	IXMLFragment xmlf3 = new NoTaggedXMLFragment("XML");
	IXML xml2 = new ConsLoXMLFragment(xmlf3, mtLoXML);
	ILoAttributeValuePair mtAttributeValuePair = new MTLoAttributeValuePair();
	IXMLFragment xmlf4 = new TaggedXMLFragment(new Tag("yell"), mtAttributeValuePair, xml2);
	IXMLFragment xmlf5 = new NoTaggedXMLFragment("!");
	IXML xml3 = new ConsLoXMLFragment(xmlf2, 
							new ConsLoXMLFragment(xmlf4, 
									new ConsLoXMLFragment(xmlf5, mtLoXML)));
	
	IXMLFragment x = new NoTaggedXMLFragment("X");
	IXMLFragment ml = new NoTaggedXMLFragment("ML");
	Tag yell = new Tag("yell");
	Tag italic = new Tag("italic");
	IXML xml4 = new ConsLoXMLFragment(x, mtLoXML);  // X
	IXMLFragment xmlf6 = new TaggedXMLFragment(italic, mtAttributeValuePair, xml4);
	// <italic>X</italic>ML
	IXML xml5 = new ConsLoXMLFragment(xmlf6, 
							new ConsLoXMLFragment(ml, mtLoXML)); 
	AttributeValuePair attriValue1 = new AttributeValuePair("volume", "30db");
	ILoAttributeValuePair mtLoAV = new MTLoAttributeValuePair();
	ILoAttributeValuePair loAV = new ConsLoAttributeValuePair(attriValue1, mtLoAV);
	IXMLFragment xmlf7 = new TaggedXMLFragment(yell, loAV, xml5);
	IXML xml6 = new ConsLoXMLFragment(xmlf2,
							new ConsLoXMLFragment(xmlf7,
									new ConsLoXMLFragment(xmlf5, mtLoXML)));

	// tests for contentLength()
	boolean testContentLength(Tester t) {
		return
		t.checkExpect(mtLoXML.contentLength(), 0) &&
		t.checkExpect(xml1.contentLength(), "I am XML!".length()) &&
		t.checkExpect(xml3.contentLength(), "I am XML!".length()) &&
		t.checkExpect(xml6.contentLength(), "I am XML!".length());
	}
	
	// tests for maxNest()
	boolean testMaxNest(Tester t) {
		return
		t.checkExpect(mtLoXML.maxNest(), 0) &&
		t.checkExpect(xml1.maxNest(), 0) &&
		t.checkExpect(xml3.maxNest(), 1) &&
		t.checkExpect(xml6.maxNest(), 2);
	}
	
	// tests for hasTag()
	boolean testHasTag(Tester t) {
		return
		t.checkExpect(mtLoXML.hasTag(this.italic), false) &&
		t.checkExpect(xml1.hasTag(this.italic), false) &&
		t.checkExpect(xml3.hasTag(this.italic), false) &&
		t.checkExpect(xml6.hasTag(this.italic), true);
	}
	
	// tests for hasAttribute()
	boolean testHasAttribute(Tester t) {
		String volume = new String("volume");
		return
		t.checkExpect(mtLoXML.hasAttribute(volume), false) &&
		t.checkExpect(xml1.hasAttribute(volume), false) &&
		t.checkExpect(xml3.hasAttribute(volume), false) &&
		t.checkExpect(xml6.hasAttribute(volume), true);
	}
	
	// tests for hasAttributeInTag()
	boolean testHasAttributeInTag(Tester t) {
		String volume = new String("volume");
		System.out.println(xml1);
		System.out.println(xml3);
		System.out.println(xml6);
		return
		t.checkExpect(mtLoXML.hasAttributeInTag(volume, this.yell), false) &&
		t.checkExpect(xml1.hasAttributeInTag(volume, this.yell), false) &&
		t.checkExpect(xml3.hasAttributeInTag(volume, this.yell), false) &&
		t.checkExpect(xml6.hasAttributeInTag(volume, this.yell), true);
	}
}